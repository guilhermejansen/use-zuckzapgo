services:
  zuckzapgo-server:
    image: setupautomatizado/zuckzapgo-private:latest
    ports:
      - "8080:8080"
    environment:
      # =================== LICENCIAMENTO E IDENTIDADE ===================
      # LICENSE_KEY: Chave de licença emitida pela ZuckZapGo; habilita ou restringe recursos como botões e flows.
      - LICENSE_KEY=SEU_LICENSE_KEY_AQUI
      # INSTANCE_ID: Identificador opcional desta instância; use para rastrear ambientes multi-tenant ou clusters.
      - INSTANCE_ID=
      # SERVER_IP: Endereço IP público divulgado para integrações externas que exigem IP fixo; deixe vazio se usar DNS.
      - SERVER_IP=

      # Healthcheck
      - APP_ENV=production
      - APP_REGION=br-central-1
      - GIT_COMMIT=local-build

      # =================== ENDEREÇOS DA APLICAÇÃO ===================
      # ZUCKZAPGO_ADDRESS: URL base publicada em todos os eventos (webhook, filas, sockets) indicando a origem da instância.
      - ZUCKZAPGO_ADDRESS=http://localhost:8080
      # ZUCKZAPGO_PORT: Porta HTTP exposta pelo backend; precisa coincidir com o mapeamento de portas do container.
      - ZUCKZAPGO_PORT=8080

      # =================== OBSERVABILIDADE DE LOGS ===================
      # ZUCKZAPGO_LOG_LEVEL: Nível mínimo de log global (debug, info, warn, error) respeitado por todo o serviço.
      - ZUCKZAPGO_LOG_LEVEL=info
      # ZUCKZAPGO_DEBUG: Nível de log dedicado ao cliente WhatsMeow; vazio usa o padrão info.
      - ZUCKZAPGO_DEBUG=info
      # LOG_TYPE: Destino/formato do logger estruturado (ex.: console, json).
      - LOG_TYPE=console
      # LOG_COLOR: Quando true, habilita códigos ANSI para colorir logs no console.
      - LOG_COLOR=true

      # =================== AUTENTICAÇÃO INTERNA ===================
      # ZUCKZAPGO_ADMIN_TOKEN: Token estático exigido em endpoints administrativos protegidos da API.
      - ZUCKZAPGO_ADMIN_TOKEN=SEU_ADMIN_TOKEN_AQUI_ADMIN_TOKEN_AQUI

      # =================== IDENTIDADE DA SESSÃO ===================
      # SESSION_DEVICE_NAME: Nome apresentado ao WhatsApp para identificar o dispositivo da sessão global.
      - SESSION_DEVICE_NAME=zuckzapgo
      # TZ: Timezone padrão utilizado por logs, agendadores e conversões de horário.
      - TZ=America/Sao_Paulo

      # ========== CONFIGURAÇÕES PADRÃO DE DISPOSITIVO WHATSAPP ==========
      # ========================================
      # NOTAS IMPORTANTES
      # ========================================
      #
      # 1. TODAS as configurações são OPCIONAIS
      # 2. Se não configuradas, usa padrões da whatsmeow
      # 3. Configurações por usuário sobrepõem globais
      # 4. Configurações aplicadas ANTES da conexão WhatsApp
      # 5. Para alterar configurações existentes, desconecte e reconecte o usuário
      # 6. Valores inválidos usam padrões com log de aviso
      #
      # ========================================
      # VALORES VÁLIDOS POR CAMPO
      # ========================================
      #
      # waPlatform:
      # ANDROID, IOS, WINDOWS_PHONE, BLACKBERRY, BLACKBERRYX, S40, S60,
      # PYTHON_CLIENT, TIZEN, ENTERPRISE, SMB_ANDROID, KAIOS, SMB_IOS,
      # WINDOWS, WEB, PORTAL, GREEN_ANDROID, GREEN_IPHONE, BLUE_ANDROID,
      # BLUE_IPHONE, FBLITE_ANDROID, MLITE_ANDROID, IGLITE_ANDROID, PAGE,
      # MACOS, OCULUS_MSG, OCULUS_CALL, MILAN, CAPI, WEAROS, ARDEVICE,
      # VRDEVICE, BLUE_WEB, IPAD, TEST, SMART_GLASSES, BLUE_VR
      #
      # waReleaseChannel:
      # RELEASE, BETA, ALPHA, DEBUG
      #
      # waWebSubPlatform:
      # WEB_BROWSER, APP_STORE, WIN_STORE, DARWIN, WIN32, WIN_HYBRID
      #
      # waConnectType:
      # CELLULAR_UNKNOWN, WIFI_UNKNOWN, CELLULAR_EDGE, CELLULAR_IDEN,
      # CELLULAR_UMTS, CELLULAR_EVDO, CELLULAR_GPRS, CELLULAR_HSDPA,
      # CELLULAR_HSUPA, CELLULAR_HSPA, CELLULAR_CDMA, CELLULAR_1XRTT,
      # CELLULAR_EHRPD, CELLULAR_LTE, CELLULAR_HSPAP
      #
      # waPlatformType:
      # UNKNOWN, CHROME, FIREFOX, IE, OPERA, SAFARI, EDGE, DESKTOP, IPAD,
      # ANDROID_TABLET, OHANA, ALOHA, CATALINA, TCL_TV, IOS_PHONE,
      # IOS_CATALYST, ANDROID_PHONE, ANDROID_AMBIGUOUS, WEAR_OS, AR_WRIST,
      # AR_DEVICE, UWP, VR, CLOUD_API, SMARTGLASSES

      # Este arquivo mostra como configurar as opções avançadas do WhatsApp
      # através de variáveis de ambiente (globais) ou via API (por usuário).
      #
      # IMPORTANTE: Estas configurações são OPCIONAIS. Se não definidas,
      # o ZuckZapGo usa os padrões da biblioteca whatsmeow.

      # ========================================
      # CONFIGURAÇÕES GLOBAIS (Variáveis de Ambiente)
      # ========================================
      # Aplicam-se a TODOS os usuários se não configuradas individualmente

      # Versão do WhatsApp Web (formato: primary.secondary.tertiary)
      # WA_VERSION=2.3000.1029948479

      # Plataforma do dispositivo
      # Opções: WEB, ANDROID, IOS, WINDOWS, MACOS, IPAD, etc.
      # WA_PLATFORM=WEB

      # Canal de release
      # Opções: RELEASE, BETA, ALPHA, DEBUG
      # WA_RELEASE_CHANNEL=RELEASE

      # Sub-plataforma para Web
      # Opções: WEB_BROWSER, APP_STORE, WIN_STORE, DARWIN, WIN32, WIN_HYBRID
      # WA_WEB_SUB_PLATFORM=WEB_BROWSER

      # Sistema operacional
      # WA_OS_NAME=Mac OS
      # WA_OS_VERSION=10.15.7

      # Informações do dispositivo
      # WA_DEVICE_NAME=SAFARI
      # WA_MANUFACTURER=Apple
      # WA_DEVICE_BOARD=

      # Configurações de localização
      # WA_LOCALE_LANGUAGE=en
      # WA_LOCALE_COUNTRY=US

      # Códigos de rede móvel
      # WA_MCC=000
      # WA_MNC=000

      # Tipo de conexão
      # Opções: WIFI_UNKNOWN, CELLULAR_UNKNOWN, CELLULAR_LTE, etc.
      # WA_CONNECT_TYPE=WIFI_UNKNOWN

      # Tipo de plataforma para DeviceProps
      # Opções: DESKTOP, CHROME, FIREFOX, SAFARI, EDGE, IPAD, etc.
      # WA_PLATFORM_TYPE=SAFARI

      # =================== CONFIGURAÇÕES DE WEBHOOK INDIVIDUAL ===================
      # WEBHOOK_FORMAT: Formato padrão do payload enviado para webhooks individuais (json ou form).
      - WEBHOOK_FORMAT=json
      # WEBHOOK_TIMEOUT: Tempo máximo de espera por resposta do webhook individual antes de considerar timeout.
      - WEBHOOK_TIMEOUT=30s
      # WEBHOOK_MAX_RETRIES: Número de tentativas adicionais após uma falha no webhook individual.
      - WEBHOOK_MAX_RETRIES=3
      # WEBHOOK_RETRY_DELAY: Intervalo inicial entre retentativas de webhook individual.
      - WEBHOOK_RETRY_DELAY=2s
      # WEBHOOK_MAX_RETRY_DELAY: Limite superior para o backoff exponencial de webhook individual.
      - WEBHOOK_MAX_RETRY_DELAY=30s
      # WEBHOOK_BACKOFF_FACTOR: Fator multiplicador aplicado ao delay a cada nova tentativa.
      - WEBHOOK_BACKOFF_FACTOR=2.0
      # WEBHOOK_MAX_CONCURRENCY: Quantidade máxima de entregas simultâneas de webhooks individuais.
      - WEBHOOK_MAX_CONCURRENCY=100

      # =================== BANCO DE DADOS ===================
      # DATABASE_URL: String de conexão completa para o banco primário (Postgres/MySQL) usada pela aplicação.
      - DATABASE_URL=postgres://zuckzapgo:zuckzapgo@localhost:5432/zuckzapgo?sslmode=disable&search_path=public
      # DB_TYPE: Driver relacional preferido (postgres ou mysql) quando utilizar variáveis isoladas.
      - DB_TYPE=postgres

      # =================== POSTGRESQL CONNECTION POOL (ALTA CARGA) ===================
      # Configurações do pool de conexões PostgreSQL otimizadas para cenários de alta carga
      # DB_MAX_OPEN_CONNS: Máximo de conexões abertas simultâneas no pool.
      - DB_MAX_OPEN_CONNS=200
      # DB_MAX_IDLE_CONNS: Máximo de conexões ociosas mantidas no pool (recomendado ~30-40% do max_open).
      - DB_MAX_IDLE_CONNS=75
      # DB_CONN_MAX_LIFETIME_MINUTES: Tempo máximo de vida de uma conexão antes de ser reciclada.
      - DB_CONN_MAX_LIFETIME_MINUTES=30
      # DB_CONN_MAX_IDLE_TIME_MINUTES: Tempo máximo que uma conexão pode ficar ociosa antes de ser fechada.
      - DB_CONN_MAX_IDLE_TIME_MINUTES=5

      # =================== STARTUP E WATCHDOG (ALTA CARGA) ===================
      # Configurações para inicialização controlada e monitoramento de clientes WhatsApp.
      # STARTUP_BATCH_SIZE: Quantidade de clientes WhatsApp iniciados por lote.
      - STARTUP_BATCH_SIZE=50
      # STARTUP_BATCH_DELAY_MS: Delay em milissegundos entre lotes de inicialização.
      - STARTUP_BATCH_DELAY_MS=2000
      # WATCHDOG_INTERVAL_SECONDS: Intervalo do watchdog para verificar saúde dos clientes (default: 300 = 5 minutos).
      - WATCHDOG_INTERVAL_SECONDS=300

      # =================== FILTROS GLOBAIS DE EVENTOS ===================
      # GLOBAL_SKIP_MEDIA_DOWNLOAD: Se true, desativa o download de mídias para todos os usuários.
      - GLOBAL_SKIP_MEDIA_DOWNLOAD=false
      # GLOBAL_SKIP_GROUPS: Se true, ignora eventos originados em conversas de grupo.
      - GLOBAL_SKIP_GROUPS=false
      # GLOBAL_SKIP_NEWSLETTERS: Se true, descarta eventos vindos de newsletters.
      - GLOBAL_SKIP_NEWSLETTERS=false
      # GLOBAL_SKIP_BROADCASTS: Se true, não processa mensagens de listas de transmissão e status.
      - GLOBAL_SKIP_BROADCASTS=false
      # GLOBAL_SKIP_OWN_MESSAGES: Se true, ignora mensagens enviadas pelo próprio usuário.
      - GLOBAL_SKIP_OWN_MESSAGES=false
      # GLOBAL_SKIP_CALLS: Se true, bloqueia o processamento de eventos de chamadas.
      - GLOBAL_SKIP_CALLS=false
      # GLOBAL_CALL_REJECT_MESSAGE: Mensagem fixa enviada ao rejeitar automaticamente chamadas recebidas.
      - GLOBAL_CALL_REJECT_MESSAGE=Sorry, I cannot take calls at the moment.
      # GLOBAL_CALL_REJECT_TYPE: Tipo de rejeição aplicado (busy, decline ou unavailable).
      - GLOBAL_CALL_REJECT_TYPE=busy

      # =================== COMPORTAMENTO DE API ===================
      # ECHO_API_MESSAGES_ENABLED: Quando true, gera eventos de confirmação para mensagens disparadas via API (echo).
      - ECHO_API_MESSAGES_ENABLED=false

      # =================== ARMAZENAMENTO GLOBAL S3 ===================
      # GLOBAL_S3_ENABLED: Controla se mídias globais serão persistidas em um bucket S3.
      - GLOBAL_S3_ENABLED=false
      # GLOBAL_S3_ENDPOINT: Endpoint HTTP(S) do provedor S3; deixe vazio para AWS padrão.
      - GLOBAL_S3_ENDPOINT=http://localhost:9001
      # GLOBAL_S3_REGION: Região S3 utilizada na autenticação e geração de URLs.
      - GLOBAL_S3_REGION=us-east-1
      # GLOBAL_S3_BUCKET: Nome do bucket onde as mídias globais serão guardadas.
      - GLOBAL_S3_BUCKET=zuckzapgo
      # GLOBAL_S3_ACCESS_KEY: Access key do provedor S3 (deixe vazio para perfis IAM).
      - GLOBAL_S3_ACCESS_KEY=
      # GLOBAL_S3_SECRET_KEY: Secret key do provedor S3 (deixe vazio para perfis IAM).
      - GLOBAL_S3_SECRET_KEY=
      # GLOBAL_S3_PATH_STYLE: Quando true, utiliza path-style URLs (compatível com MinIO/outros provedores).
      - GLOBAL_S3_PATH_STYLE=true
      # GLOBAL_S3_PUBLIC_URL: URL pública usada para montar links acessíveis externamente.
      - GLOBAL_S3_PUBLIC_URL=http://localhost:9001
      # GLOBAL_S3_MEDIA_DELIVERY: Modo de entrega das mídias nos eventos (base64, s3, url ou both). "url" e "s3" são equivalentes.
      - GLOBAL_S3_MEDIA_DELIVERY=url
      # GLOBAL_S3_RETENTION_DAYS: Quantidade de dias antes de expirar objetos armazenados (0 desativa expiração).
      - GLOBAL_S3_RETENTION_DAYS=1
      # GLOBAL_S3_DISABLE_ACL: Define se ACLs individuais serão suprimidos; true para buckets com Bucket Owner Enforced.
      - GLOBAL_S3_DISABLE_ACL=true

      # =================== S3 RETENTION CLEANUP ===================
      # Sistema de limpeza automática de objetos S3 expirados.
      # O worker GLOBAL processa todos os usuários com s3_enabled=true E s3_retention_days > 0.
      # S3_RETENTION_ENABLED: Habilita/desabilita o worker de limpeza.
      - S3_RETENTION_ENABLED=true
      # S3_RETENTION_INTERVAL: Intervalo entre ciclos de limpeza (default: 1h).
      - S3_RETENTION_INTERVAL=1h
      # S3_RETENTION_MAX_CONCURRENCY: Máximo de usuários processados em paralelo.
      - S3_RETENTION_MAX_CONCURRENCY=5
      # S3_RETENTION_BATCH_SIZE: Objetos por batch de delete (max: 1000).
      - S3_RETENTION_BATCH_SIZE=1000
      # S3_RETENTION_OBJECTS_PER_CYCLE: Limite de objetos por ciclo por usuário.
      - S3_RETENTION_OBJECTS_PER_CYCLE=10000
      # S3_RETENTION_OPERATION_TIMEOUT: Timeout para operação de limpeza por usuário.
      - S3_RETENTION_OPERATION_TIMEOUT=10m

      # =================== DISTRIBUIÇÃO GLOBAL SQS ===================
      # GLOBAL_SQS_ENABLED: Ativa o fan-out de eventos para uma fila Amazon SQS.
      - GLOBAL_SQS_ENABLED=false
      # GLOBAL_SQS_REGION: Região AWS onde a fila SQS está provisionada.
      - GLOBAL_SQS_REGION=us-east-1
      # GLOBAL_SQS_QUEUE_URL: URL completa da fila SQS alvo.
      - GLOBAL_SQS_QUEUE_URL=
      # GLOBAL_SQS_PROFILE: Perfil AWS CLI usado localmente (opcional).
      - GLOBAL_SQS_PROFILE=
      # GLOBAL_SQS_ACCESS_KEY: Access key AWS dedicada ao uso da fila.
      - GLOBAL_SQS_ACCESS_KEY=
      # GLOBAL_SQS_SECRET_KEY: Secret key AWS correspondente.
      - GLOBAL_SQS_SECRET_KEY=
      # GLOBAL_SQS_SESSION_TOKEN: Token temporário (STS) quando utilizado.
      - GLOBAL_SQS_SESSION_TOKEN=
      # GLOBAL_SQS_ENDPOINT: Endpoint customizado para LocalStack ou provedores compatíveis.
      - GLOBAL_SQS_ENDPOINT=
      # GLOBAL_SQS_FIFO: Indica se a fila utiliza modo FIFO.
      - GLOBAL_SQS_FIFO=false
      # GLOBAL_SQS_MESSAGE_GROUP: Identificador do grupo de mensagens FIFO.
      - GLOBAL_SQS_MESSAGE_GROUP=zuckzapgo-global
      # GLOBAL_SQS_DELAY_SECONDS: Delay padrão aplicado a cada mensagem publicada.
      - GLOBAL_SQS_DELAY_SECONDS=0
      # GLOBAL_SQS_EVENTS: Eventos encaminhados para a fila (lista ou 'All').
      - GLOBAL_SQS_EVENTS=All
      # GLOBAL_SQS_TIMEOUT: Timeout das operações de publicação na fila.
      - GLOBAL_SQS_TIMEOUT=5s
      # GLOBAL_SQS_RETRY_DELAY: Intervalo entre retentativas em caso de falha.
      - GLOBAL_SQS_RETRY_DELAY=750ms
      # GLOBAL_SQS_MAX_RETRIES: Quantidade máxima de tentativas antes de desistir.
      - GLOBAL_SQS_MAX_RETRIES=3

      # =================== STREAMS REDIS GLOBAL ===================
      # GLOBAL_REDIS_ENABLED: Ativa distribuição de eventos em Redis Streams globais.
      - GLOBAL_REDIS_ENABLED=false
      # GLOBAL_REDIS_ADDRESS: Endereço host:porta do servidor Redis alvo.
      - GLOBAL_REDIS_ADDRESS=localhost:6379
      # GLOBAL_REDIS_USERNAME: Usuário opcional para autenticação Redis ACL.
      - GLOBAL_REDIS_USERNAME=
      # GLOBAL_REDIS_PASSWORD: Senha associada ao usuário Redis.
      - GLOBAL_REDIS_PASSWORD=
      # GLOBAL_REDIS_TLS: Quando true, estabelece a conexão Redis via TLS.
      - GLOBAL_REDIS_TLS=false
      # GLOBAL_REDIS_STREAM: Nome do stream onde os eventos serão escritos.
      - GLOBAL_REDIS_STREAM=zuckzapgo.events
      # GLOBAL_REDIS_EVENTS: Eventos elegíveis para publicação em Redis.
      - GLOBAL_REDIS_EVENTS=All
      # GLOBAL_REDIS_MAXLEN: Comprimento máximo do stream antes de truncar mensagens antigas.
      - GLOBAL_REDIS_MAXLEN=100000
      # GLOBAL_REDIS_TRIM_APPROX: Se true, a poda do stream é aproximada (mais rápida).
      - GLOBAL_REDIS_TRIM_APPROX=true
      # GLOBAL_REDIS_TIMEOUT: Timeout de operações com Redis.
      - GLOBAL_REDIS_TIMEOUT=2s
      # GLOBAL_REDIS_RETRY_DELAY: Delay entre retentativas ao falhar.
      - GLOBAL_REDIS_RETRY_DELAY=500ms
      # GLOBAL_REDIS_MAX_RETRIES: Quantidade máxima de tentativas antes de abortar.
      - GLOBAL_REDIS_MAX_RETRIES=3

      # =================== ENTREGAS VIA WEBSOCKET ===================
      # GLOBAL_WEBSOCKET_ENABLED: Habilita broadcast global de eventos via WebSocket.
      - GLOBAL_WEBSOCKET_ENABLED=false
      # GLOBAL_WEBSOCKET_ENDPOINTS: Lista de endpoints ws:// ou wss:// separados por vírgula.
      - GLOBAL_WEBSOCKET_ENDPOINTS=
      # GLOBAL_WEBSOCKET_EVENTS: Eventos encaminhados por WebSocket (lista ou 'All').
      - GLOBAL_WEBSOCKET_EVENTS=All
      # GLOBAL_WEBSOCKET_ENABLE_COMPRESSION: Quando true, ativa compressão no transporte WebSocket.
      - GLOBAL_WEBSOCKET_ENABLE_COMPRESSION=true
      # GLOBAL_WEBSOCKET_HEADERS: Cabeçalhos adicionais enviados na conexão WebSocket.
      - GLOBAL_WEBSOCKET_HEADERS=
      # GLOBAL_WEBSOCKET_TIMEOUT: Tempo limite para estabelecer a conexão.
      - GLOBAL_WEBSOCKET_TIMEOUT=10s
      # GLOBAL_WEBSOCKET_WRITE_TIMEOUT: Timeout aplicado durante o envio de mensagens.
      - GLOBAL_WEBSOCKET_WRITE_TIMEOUT=5s
      # GLOBAL_WEBSOCKET_RETRY_DELAY: Delay inicial para novas tentativas de conexão.
      - GLOBAL_WEBSOCKET_RETRY_DELAY=2s
      # GLOBAL_WEBSOCKET_MAX_RETRIES: Número máximo de tentativas de reconexão.
      - GLOBAL_WEBSOCKET_MAX_RETRIES=5

      # =================== WEBHOOK GLOBAL ===================
      # GLOBAL_WEBHOOK_ENABLED: Ativa entrega de eventos para um endpoint global.
      - GLOBAL_WEBHOOK_ENABLED=false
      # GLOBAL_WEBHOOK_URL: Endpoint HTTP que receberá todos os eventos globais.
      - GLOBAL_WEBHOOK_URL=http://localhost:5454/webhook/events-zuckzapgo
      # GLOBAL_WEBHOOK_EVENTS: Eventos filtrados e enviados ao webhook global.
      - GLOBAL_WEBHOOK_EVENTS=All
      # GLOBAL_WEBHOOK_TIMEOUT: Tempo máximo para resposta do webhook global.
      - GLOBAL_WEBHOOK_TIMEOUT=30s
      # GLOBAL_WEBHOOK_RETRY_COUNT: Total de retentativas em caso de falha.
      - GLOBAL_WEBHOOK_RETRY_COUNT=3
      # GLOBAL_WEBHOOK_RETRY_DELAY: Delay inicial entre retentativas.
      - GLOBAL_WEBHOOK_RETRY_DELAY=2s
      # GLOBAL_WEBHOOK_MAX_RETRY_DELAY: Teto do backoff exponencial nas retentativas.
      - GLOBAL_WEBHOOK_MAX_RETRY_DELAY=30s
      # GLOBAL_WEBHOOK_BACKOFF_FACTOR: Multiplicador aplicado ao delay a cada tentativa.
      - GLOBAL_WEBHOOK_BACKOFF_FACTOR=2.0
      # GLOBAL_WEBHOOK_CONCURRENCY: Quantidade máxima de envios simultâneos ao webhook global.
      - GLOBAL_WEBHOOK_CONCURRENCY=50

      # =================== RABBITMQ GLOBAL - HABILITAÇÃO ===================
      # GLOBAL_RABBITMQ_ENABLED: Habilita fan-out global de eventos através do RabbitMQ.
      - GLOBAL_RABBITMQ_ENABLED=false
      # GLOBAL_RABBITMQ_URL: URL AMQP com usuário, senha e vhost do cluster RabbitMQ.
      - GLOBAL_RABBITMQ_URL=amqp://zuckzapgo:zuckzapgo@localhost:5672/zuckzapgo
      # GLOBAL_RABBITMQ_EVENTS: Eventos roteados para o exchange global.
      - GLOBAL_RABBITMQ_EVENTS=Message
      # GLOBAL_RABBITMQ_EXCHANGE: Exchange destino para publicação dos eventos globais.
      - GLOBAL_RABBITMQ_EXCHANGE=zuckzapgo.global
      # GLOBAL_RABBITMQ_EXCHANGE_TYPE: Tipo de exchange (topic, fanout, direct, etc).
      - GLOBAL_RABBITMQ_EXCHANGE_TYPE=topic
      # GLOBAL_RABBITMQ_QUEUE: Template de nome das filas globais (aceita placeholders).
      - GLOBAL_RABBITMQ_QUEUE=zuckzapgo_{user_id}_{event_type}_events
      # GLOBAL_RABBITMQ_ROUTING_KEY: Template de routing key usada nos bindings.
      - GLOBAL_RABBITMQ_ROUTING_KEY=events.{user_id}.{event_type}
      # GLOBAL_RABBITMQ_QUEUE_TYPE: Tipo da fila declarada (classic, quorum, stream).
      - GLOBAL_RABBITMQ_QUEUE_TYPE=classic
      # GLOBAL_RABBITMQ_DURABLE: Define se filas/exchanges sobrevivem a reinícios do broker.
      - GLOBAL_RABBITMQ_DURABLE=true
      # GLOBAL_RABBITMQ_AUTO_DELETE: Remove filas/exchanges automaticamente quando não houver consumidores.
      - GLOBAL_RABBITMQ_AUTO_DELETE=false
      # GLOBAL_RABBITMQ_EXCLUSIVE: Se true, fila exclusiva para a conexão (não compartilhada).
      - GLOBAL_RABBITMQ_EXCLUSIVE=false
      # GLOBAL_RABBITMQ_NO_WAIT: Evita aguardar confirmações nas declarações AMQP.
      - GLOBAL_RABBITMQ_NO_WAIT=false
      # GLOBAL_RABBITMQ_DELIVERY_MODE: Modo de entrega: 1 não persistente, 2 persistente.
      - GLOBAL_RABBITMQ_DELIVERY_MODE=2

      # =================== RABBITMQ GLOBAL - PERFORMANCE E RESILIÊNCIA ===================
      # GLOBAL_RABBITMQ_CONNECTION_POOL_SIZE: Quantidade de conexões paralelas utilizadas para publicar eventos.
      - GLOBAL_RABBITMQ_CONNECTION_POOL_SIZE=50
      # GLOBAL_RABBITMQ_WORKER_COUNT: Número de workers dedicados ao processamento global.
      - GLOBAL_RABBITMQ_WORKER_COUNT=100
      # GLOBAL_RABBITMQ_QUEUE_BUFFER_SIZE: Buffer interno de mensagens aguardando publicação.
      - GLOBAL_RABBITMQ_QUEUE_BUFFER_SIZE=100000
      # GLOBAL_RABBITMQ_ENABLE_BATCHING: Quando true, agrupa mensagens em lotes para ganho de throughput.
      - GLOBAL_RABBITMQ_ENABLE_BATCHING=true
      # GLOBAL_RABBITMQ_BATCH_SIZE: Quantidade máxima de mensagens em cada lote.
      - GLOBAL_RABBITMQ_BATCH_SIZE=1000
      # GLOBAL_RABBITMQ_BATCH_TIMEOUT_MS: Tempo máximo (ms) aguardando completar um lote.
      - GLOBAL_RABBITMQ_BATCH_TIMEOUT_MS=100
      # GLOBAL_RABBITMQ_CIRCUIT_BREAKER_THRESHOLD: Falhas consecutivas necessárias para abrir o circuito.
      - GLOBAL_RABBITMQ_CIRCUIT_BREAKER_THRESHOLD=20
      # GLOBAL_RABBITMQ_CIRCUIT_BREAKER_TIMEOUT_S: Tempo de espera antes de testar reabertura do circuito.
      - GLOBAL_RABBITMQ_CIRCUIT_BREAKER_TIMEOUT_S=60
      # GLOBAL_RABBITMQ_PUBLISH_TIMEOUT_MS: Timeout por operação de publicação.
      - GLOBAL_RABBITMQ_PUBLISH_TIMEOUT_MS=5000
      # GLOBAL_RABBITMQ_MAX_RETRIES: Número máximo de retentativas por mensagem.
      - GLOBAL_RABBITMQ_MAX_RETRIES=5
      # GLOBAL_RABBITMQ_RETRY_DELAY_MS: Delay (ms) entre retentativas.
      - GLOBAL_RABBITMQ_RETRY_DELAY_MS=500
      # GLOBAL_RABBITMQ_METRICS_INTERVAL_S: Intervalo (s) de coleta e emissão de métricas do transporte.
      - GLOBAL_RABBITMQ_METRICS_INTERVAL_S=10

      # =================== RABBITMQ GLOBAL - OBSERVABILIDADE ===================
      # GLOBAL_RABBITMQ_ENABLE_DETAILED_LOGS: Quando true, habilita logs detalhados do transporte RabbitMQ.
      - GLOBAL_RABBITMQ_ENABLE_DETAILED_LOGS=false
      # GLOBAL_RABBITMQ_ENABLE_METRICS_LOG: Quando true, registra métricas periódicas no log.
      - GLOBAL_RABBITMQ_ENABLE_METRICS_LOG=true
      # GLOBAL_RABBITMQ_QOS_PREFETCH_COUNT: Quantidade de mensagens pré-buscadas por consumidor.
      - GLOBAL_RABBITMQ_QOS_PREFETCH_COUNT=100
      # GLOBAL_RABBITMQ_MANDATORY: Se true, exige roteamento obrigatório (mensagens não roteadas retornam).
      - GLOBAL_RABBITMQ_MANDATORY=false
      # GLOBAL_RABBITMQ_IMMEDIATE: Flag obsoleta do AMQP; mantenha false salvo compatibilidade legada.
      - GLOBAL_RABBITMQ_IMMEDIATE=false
      # GLOBAL_RABBITMQ_ENABLE_COMPRESSION: Comprime payloads antes de publicar para reduzir banda.
      - GLOBAL_RABBITMQ_ENABLE_COMPRESSION=false
      # GLOBAL_RABBITMQ_ENABLE_PERSISTENCE: Garante persistência em disco das mensagens publicadas.
      - GLOBAL_RABBITMQ_ENABLE_PERSISTENCE=true
      # GLOBAL_RABBITMQ_ENABLE_CONFIRMATION: Habilita publisher confirms para garantir recebimento pelo broker.
      - GLOBAL_RABBITMQ_ENABLE_CONFIRMATION=true

      # =================== RABBITMQ POR INSTÂNCIA ===================
      # RABBITMQ_CONNECTION_POOL_SIZE: Tamanho do pool de conexões dedicado a cada instância de cliente.
      - RABBITMQ_CONNECTION_POOL_SIZE=50
      # RABBITMQ_WORKER_COUNT: Total de workers concorrentes por instância.
      - RABBITMQ_WORKER_COUNT=100
      # RABBITMQ_QUEUE_BUFFER_SIZE: Buffer interno de mensagens por instância.
      - RABBITMQ_QUEUE_BUFFER_SIZE=100000
      # RABBITMQ_BATCH_SIZE: Quantidade de mensagens por lote em instâncias individuais.
      - RABBITMQ_BATCH_SIZE=1000
      # RABBITMQ_BATCH_TIMEOUT_MS: Timeout (ms) para completar lote individual.
      - RABBITMQ_BATCH_TIMEOUT_MS=100
      # RABBITMQ_PUBLISH_TIMEOUT_MS: Timeout de publicação por instância.
      - RABBITMQ_PUBLISH_TIMEOUT_MS=5000
      # RABBITMQ_MAX_RETRIES: Retentativas locais por mensagem.
      - RABBITMQ_MAX_RETRIES=5
      # RABBITMQ_RETRY_DELAY_MS: Delay (ms) entre retentativas locais.
      - RABBITMQ_RETRY_DELAY_MS=500

      # =================== TRACING DISTRIBUÍDO ===================
      # TRACING_ENABLED: Ativa a instrumentação OpenTelemetry na aplicação.
      - TRACING_ENABLED=false
      # JAEGER_ENDPOINT: Endpoint OTLP HTTP utilizado para enviar spans ao Jaeger.
      - JAEGER_ENDPOINT=http://localhost:14268/api/traces
      # JAEGER_SAMPLING_RATIO: Percentual de requisições amostradas (0.0 a 1.0).
      - JAEGER_SAMPLING_RATIO=0.1
      # TRACING_SERVICE_NAME: Nome lógico do serviço reportado ao tracer.
      - TRACING_SERVICE_NAME=zuckzapgo
      # TRACING_SERVICE_VERSION: Versão reportada nas tags de tracing.
      - TRACING_SERVICE_VERSION=v1.6.0
      # TRACING_ENVIRONMENT: Identificador do ambiente (development, staging, production).
      - TRACING_ENVIRONMENT=development

      # =================== MONITORAMENTO DE ERROS (SENTRY) ===================
      # SENTRY_ENABLED: Liga/desliga a captura de exceções pela SDK do Sentry.
      - SENTRY_ENABLED=false
      # SENTRY_DSN: DSN fornecido pelo projeto Sentry para autenticação.
      - SENTRY_DSN=
      # SENTRY_ENVIRONMENT: Ambiente lógico usado para agrupar eventos no Sentry.
      - SENTRY_ENVIRONMENT=development
      # SENTRY_SAMPLE_RATE: Percentual de erros capturados (0.0 a 1.0).
      - SENTRY_SAMPLE_RATE=1.0
      # SENTRY_TRACES_SAMPLE_RATE: Percentual de transações de performance coletadas.
      - SENTRY_TRACES_SAMPLE_RATE=1.0
      # SENTRY_PROFILES_SAMPLE_RATE: Percentual de perfis de CPU/memória coletados.
      - SENTRY_PROFILES_SAMPLE_RATE=1.0

      # =================== MÉTRICAS PROMETHEUS ===================
      # PROMETHEUS_ENABLED: Ativa a exportação de métricas para Prometheus.
      - PROMETHEUS_ENABLED=false
      # PROMETHEUS_METRICS_PATH: Path HTTP exposto com as métricas.
      - PROMETHEUS_METRICS_PATH=/metrics
      # METRICS_COLLECTION_INTERVAL: Frequência de coleta interna de métricas.
      - METRICS_COLLECTION_INTERVAL=30s
      # BUFFER_METRICS_ENABLED: Quando true, inclui métricas específicas do buffer.
      - BUFFER_METRICS_ENABLED=true
      # TRANSPORT_METRICS_ENABLED: Quando true, inclui métricas das integrações (RabbitMQ, SQS, etc.).
      - TRANSPORT_METRICS_ENABLED=true

      # =================== PIPELINE GLOBAL DE EVENTOS ===================
      # GLOBAL_EVENT_BUFFER_USE_DATABASE: Se true, usa banco relacional como buffer persistente de eventos.
      - GLOBAL_EVENT_BUFFER_USE_DATABASE=true
      # GLOBAL_EVENT_BUFFER_VISIBILITY_TIMEOUT: Tempo de leasing antes de devolver o evento para a fila.
      - GLOBAL_EVENT_BUFFER_VISIBILITY_TIMEOUT=60s
      # GLOBAL_EVENT_BUFFER_RETRY_BASE: Delay base para cálculo de backoff exponencial.
      - GLOBAL_EVENT_BUFFER_RETRY_BASE=5s
      # GLOBAL_EVENT_BUFFER_RETRY_MAX: Limite máximo de delay entre tentativas.
      - GLOBAL_EVENT_BUFFER_RETRY_MAX=2m
      # GLOBAL_EVENT_BUFFER_MAX_ATTEMPTS: Número máximo de tentativas de entrega por evento.
      - GLOBAL_EVENT_BUFFER_MAX_ATTEMPTS=12
      # GLOBAL_EVENT_BUFFER_ARCHIVE_SUCCESS: Quando true, arquiva entregas bem-sucedidas além das falhas.
      - GLOBAL_EVENT_BUFFER_ARCHIVE_SUCCESS=false
      # GLOBAL_EVENT_BATCH_SIZE: Quantidade de eventos agrupados por envio.
      - GLOBAL_EVENT_BATCH_SIZE=10
      # GLOBAL_EVENT_BATCH_TIMEOUT: Tempo máximo aguardando completar um lote.
      - GLOBAL_EVENT_BATCH_TIMEOUT=500ms
      # GLOBAL_EVENT_CIRCUIT_MAX_FAILURES: Falhas consecutivas que disparam o circuito de proteção.
      - GLOBAL_EVENT_CIRCUIT_MAX_FAILURES=5
      # GLOBAL_EVENT_CIRCUIT_RESET: Intervalo antes de testar reabertura do circuito.
      - GLOBAL_EVENT_CIRCUIT_RESET=30s
      # GLOBAL_EVENT_CIRCUIT_COOLDOWN: Espera entre verificações enquanto o circuito está aberto.
      - GLOBAL_EVENT_CIRCUIT_COOLDOWN=2s
      # GLOBAL_SKIP_CACHE_TTL: TTL do cache que evita reprocessar eventos filtrados.
      - GLOBAL_SKIP_CACHE_TTL=60s
      # GLOBAL_EVENT_BUFFER_RETENTION_DAYS: Quantidade de dias mantendo registros ativos no buffer.
      - GLOBAL_EVENT_BUFFER_RETENTION_DAYS=7
      # GLOBAL_EVENT_BUFFER_ARCHIVE_RETENTION_DAYS: Dias de retenção dos registros arquivados.
      - GLOBAL_EVENT_BUFFER_ARCHIVE_RETENTION_DAYS=30
      # GLOBAL_EVENT_BUFFER_PRUNE_INTERVAL: Intervalo entre execuções de limpeza do buffer.
      - GLOBAL_EVENT_BUFFER_PRUNE_INTERVAL=1h
      # GLOBAL_EVENT_BUFFER_PRUNE_BATCH_SIZE: Número de registros processados por lote na limpeza.
      - GLOBAL_EVENT_BUFFER_PRUNE_BATCH_SIZE=1000
      # GLOBAL_EVENT_BUFFER_AUTO_PARTITION: Habilita criação automática de partições no banco do buffer.
      - GLOBAL_EVENT_BUFFER_AUTO_PARTITION=false
      # GLOBAL_EVENT_BUFFER_PARTITION_RETENTION_MONTHS: Meses mantidos por partição histórica do buffer.
      - GLOBAL_EVENT_BUFFER_PARTITION_RETENTION_MONTHS=6

      # =================== CONTROLE DE ENCERRAMENTO ===================
      # SHUTDOWN_GRACE_PERIOD: Tempo máximo aguardado para finalizar workers antes de encerrar o processo.
      - SHUTDOWN_GRACE_PERIOD=120s

      # =================== EVENT MONITORING SSE CONFIGURATION ===================
      # Enable real-time event monitoring via Server-Sent Events
      - MONITORING_ENABLED=false
      # Maximum concurrent SSE clients connected
      - MONITORING_MAX_CLIENTS=100
      # SSE heartbeat interval (keep-alive)
      - MONITORING_HEARTBEAT_INTERVAL=30s
      # Event notification buffer size
      - MONITORING_EVENT_BUFFER_SIZE=10000
      # Number of worker goroutines processing events
      - MONITORING_WORKER_COUNT=5
      # Memory cache TTL for query results
      - MONITORING_CACHE_TTL=5m
      # Cache cleanup interval (removes expired entries)
      - MONITORING_CACHE_CLEANUP_INTERVAL=1m
      # Session token TTL (for SSE authentication)
      - MONITORING_SESSION_TOKEN_TTL=5m
      # Maximum events per page for history endpoint
      - MONITORING_MAX_PAGE_SIZE=1000
      # Default page size for history endpoint
      - MONITORING_DEFAULT_PAGE_SIZE=100
      # Enable/disable persistence for monitoring events (set to false to keep only in-memory stream)
      - MONITORING_STORAGE_ENABLED=true
      # Retention window (in days) for monitoring_events table when storage is enabled
      - MONITORING_RETENTION_DAYS=7
      # Interval between automatic prune runs (e.g. 12h, 24h)
      - MONITORING_PRUNE_INTERVAL=24h
      # Absolute base URL returned in stream_url (leave empty to fall back to ZUCKZAPGO_ADDRESS or http://localhost:<port>)
      - MONITORING_STREAM_BASE_URL=http://localhost:8080
    networks:
      - zuckzapgo-network
    restart: on-failure

  postgres_zuckzapgo:
    image: pgvector/pgvector:pg16
    environment:
      POSTGRES_USER: zuckzapgo
      POSTGRES_PASSWORD: your_secure_password
      POSTGRES_DB: zuckzapgo
    ports:
      - "5432:5432"
    volumes:
      - postgres_data_zuckzapgo:/var/lib/postgresql/data
    networks:
      - zuckzapgo-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U zuckzapgo"]
      interval: 5s
      timeout: 5s
      retries: 5
    restart: always

  # =================== MYSQL DATABASE (OPCIONAL) ===================
  # Descomente as linhas abaixo para usar MySQL ao invés de PostgreSQL
  # mysql_zuckzapgo:
  #   image: mysql:8.0
  #   environment:
  #     MYSQL_ROOT_PASSWORD: your_secure_root_password
  #     MYSQL_DATABASE: zuckzapgo
  #     MYSQL_USER: zuckzapgo
  #     MYSQL_PASSWORD: your_secure_password
  #     MYSQL_ROOT_HOST: "%"
  #   ports:
  #     - "3306:3306"
  #   networks:
  #     - zuckzapgo-network
  #   restart: always
  #   volumes:
  #     - mysql_data_zuckzapgo:/var/lib/mysql
  #   command: >
  #     --default-authentication-plugin=mysql_native_password
  #     --character-set-server=utf8mb4
  #     --collation-server=utf8mb4_unicode_ci
  #     --innodb-buffer-pool-size=512M
  #     --max-connections=200
  #   healthcheck:
  #     test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
  #     timeout: 5s
  #     interval: 5s
  #     retries: 5

  # rabbitmq_zuckzapgo:
  #   image: rabbitmq:4-management
  #   environment:
  #     - RABBITMQ_DEFAULT_USER=zuckzapgo
  #     - RABBITMQ_DEFAULT_PASS=zuckzapgo
  #     - RABBITMQ_DEFAULT_VHOST=zuckzapgo
  #   ports:
  #     - "15672:15672"
  #     - "5672:5672"
  #   networks:
  #     - zuckzapgo-network
  #   restart: always
  #   volumes:
  #     - rabbitmq_data_zuckzapgo:/var/lib/rabbitmq

  # =================== REDIS STREAM ===================
  # redis_zuckzapgo:
  #   image: redis:7
  #   ports:
  #     - "6379:6379"
  #   networks:
  #     - zuckzapgo-network
  #   restart: always
  #   volumes:
  #     - redis_data_zuckzapgo:/data

  # =================== JAEGER TRACING (OBSERVABILITY) ===================
  # jaeger_zuckzapgo:
  #   image: jaegertracing/all-in-one:latest
  #   environment:
  #     # Enable OTLP collector (required for OpenTelemetry)
  #     - COLLECTOR_OTLP_ENABLED=true
  #     # Storage configuration - use memory for development
  #     - SPAN_STORAGE_TYPE=memory
  #     # Memory storage limits
  #     - MEMORY_MAX_TRACES=10000
  #     # Sampling configuration
  #     - SAMPLING_STRATEGIES_FILE=/etc/jaeger/sampling_strategies.json
  #   ports:
  #     # Jaeger UI - Web interface to view traces
  #     - "16686:16686"
  #     # OTLP HTTP receiver - used by ZuckZapGo to send traces
  #     - "4318:4318"
  #     # OTLP gRPC receiver (optional)
  #     - "4317:4317"
  #     # Jaeger Collector HTTP (legacy - for compatibility)
  #     - "14268:14268"
  #     # Jaeger Collector gRPC (legacy - for compatibility)
  #     - "14250:14250"
  #     # Jaeger Agent Zipkin Thrift (optional)
  #     - "5775:5775/udp"
  #     # Jaeger Agent Compact Thrift (optional)
  #     - "6831:6831/udp"
  #     # Jaeger Agent Binary Thrift (optional)
  #     - "6832:6832/udp"
  #     # Admin port for health checks
  #     - "14269:14269"
  #   networks:
  #     - zuckzapgo-network
  #   restart: always
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:14269/"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #     start_period: 10s
  #   volumes:
  #     - jaeger_data_zuckzapgo:/tmp/jaeger

networks:
  zuckzapgo-network:
    driver: bridge

volumes:
  postgres_data_zuckzapgo:
  # rabbitmq_data_zuckzapgo:
  # redis_data_zuckzapgo:
  # mysql_data_zuckzapgo:
  # jaeger_data_zuckzapgo:
